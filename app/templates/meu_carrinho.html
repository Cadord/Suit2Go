{% extends 'base.html' %}

{% block title %}Suit2Go - Carrinho{% endblock %}

{% block content %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
<script>
  const debouncedRefresh = debounce(() => location.relod(), 300);

  function handleUpdateQuantity(productId, amount, price) {
    const cart = getCart();
    const updatedQuantity = updateCartProductQuantity(productId, amount);
    document.getElementById('itemQtd-' + productId).innerHTML = updatedQuantity;
    if (updatedQuantity <= 0) {
      alert('Produto removido do carrinho');
      document.getElementById('cartItem-' + productId).remove();
    }

    // Update cart value
    const priceDelta = parseFloat(price) * amount;
    const totalEl = document.getElementById("total-carrinho");
    const currentTotal = parseFloat(totalEl.innerHTML);
    totalEl.innerHTML = (currentTotal + priceDelta).toFixed(2);
  }

  function handleRemoveFromCart(productId) {
    removeFromCart(productId);
    alert('Produto removido do carrinho');
    document.getElementById('cartItem-' + productId).remove();
  }

  function handleCheckout() {
  }

  function handleContinueShopping() {
    alert('Continuar compras clicked');
  }
</script>
<div class='carrinhocontainer'>
  <div class='carrinho-header'>
    <img class='carrinho-icon' src="{% static  'img/shop-cart.png' %}">
    <h2>Carrinho de compras</h2>
  </div>

  <table class='cart' id="tableCartItems">
    <thead class='cart-prod-quant'>
      <tr>
        <th></th>
        <th>Produto</th>
        <th>Valor Total</th>
        <th>Quantidade</th>
        <th></th>
      </tr>
    </thead>
    <tbody id='itenscarrinho'>
      {% for item in carrinho %}
      <tr id="cartItem-{{item.produto.id}}">
        <td>
          <img src="media/{{ item.produto.fotosroupavariacao_set.all.0.fotoUrl }}" alt="{{ item.produto.name }}"
            class="cart-item-image">
        </td>
        <td id='itemcarrinho'>{{item.produto.produto.nome}}</td>
        <td id='itemcarrinho'>R$ {{item.produto.preco_aluguel}}</td>
        <td>
          <span id="itemQtd-{{item.produto.id}}">{{item.quantity}}</span>
          <button onclick="handleUpdateQuantity('{{item.produto.id}}', -1, '{{item.produto.preco_aluguel}}')">-</button>
          <button onclick="handleUpdateQuantity('{{item.produto.id}}', 1, '{{item.produto.preco_aluguel}}')">+</button>
        </td>
        <td>
          <button onclick="handleRemoveFromCart('{{item.produto.id}}')">X</button>
        </td>
      </tr>
      {% endfor %}

      {% if carrinho|length == 0 %}
      <tr>
        <td id='cart-none' colspan="5">Nenhum item no carrinho</td>
      </tr>
      {% endif %}
    </tbody>
    <tfoot>

    </tfoot>
  </table>
</div>
<div class='frete-container'>
  <div>
    <h>Resumo</h1>
  </div>
  <!-- <div>
    <label>
      <input type="radio" name="escolha" value="opcao1"> Retirada em guichê - Grátis
    </label>
    <br>
    <label>
      <input class='opt2' type="radio" name="escolha" value="opcao2"> Retirada em local desejado - Calcular
    </label>
  </div> -->
  <div id='linha-step' class='linha'>
  </div>
  <div>
    Preço total: R$ <span id="total-carrinho">{{ valorTotal }}</span>
  </div>
  <div id='linha-step' class='linha'>
  </div>
  <div>
    <a id='checkoutbutton' href="{% url 'checkout' %}">Checkout</a>
  </div>
</div>
{% endblock %}